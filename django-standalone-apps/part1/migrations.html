
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Model migrations Â· Django Standalone Apps</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        <meta name="author" content="Ben Lopatin">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="templates.html" />
    
    
    <link rel="prev" href="docs.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="intro.html">
            
                <a href="intro.html">
            
                    
                    The Components of a Django Reusable App
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="scope.html">
            
                <a href="scope.html">
            
                    
                    Defining the Scope
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="structure.html">
            
                <a href="structure.html">
            
                    
                    Structure of a reusable app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="testing.html">
            
                <a href="testing.html">
            
                    
                    Testing outside of a project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="docs.html">
            
                <a href="docs.html">
            
                    
                    Documenting your app
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.5" data-path="migrations.html">
            
                <a href="migrations.html">
            
                    
                    Model migrations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="templates.html">
            
                <a href="templates.html">
            
                    
                    Templates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="static.html">
            
                <a href="static.html">
            
                    
                    Static files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="namespacing.md">
            
                <span>
            
                    
                    Namespacing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="packaging.html">
            
                <a href="packaging.html">
            
                    
                    Packaging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../part2/intro.html">
            
                <a href="../part2/intro.html">
            
                    
                    Scoping and Extracting Reusable Apps
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" >
            
                <span>
            
                    
                    Scoping
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" >
            
                <span>
            
                    
                    Separate
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" >
            
                <span>
            
                    
                    Reversal
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" >
            
                <span>
            
                    
                    Example extraction
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Next Steps and More Advanced Cases
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" >
            
                <span>
            
                    
                    Settings
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" >
            
                <span>
            
                    
                    i18n
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" >
            
                <span>
            
                    
                    Backwards compatibility
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" >
            
                <span>
            
                    
                    Futureproofing
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" >
            
                <span>
            
                    
                    Contrib modules
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" >
            
                <span>
            
                    
                    Migration strategies
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" >
            
                <span>
            
                    
                    Modularity
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Managing Django Reusable Apps
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" >
            
                <span>
            
                    
                    Licensing
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" >
            
                <span>
            
                    
                    Releases
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" >
            
                <span>
            
                    
                    Documentation
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" >
            
                <span>
            
                    
                    Testing
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" >
            
                <span>
            
                    
                    Automating
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" >
            
                <span>
            
                    
                    Databases
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" >
            
                <span>
            
                    
                    Collaborating
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" >
            
                <span>
            
                    
                    Templates for app
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="http://benlopatin.com" target="blank" class="gitbook-link">
            &copy; Ben Lopatin
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Model migrations</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="model-migrations">Model migrations</h1>
<p>Database schema migrations are a way of tracking and automatically
making changes to the database <em>schema</em> to match changes in app
models, such as adding new models, new fields, or changing field
parameters.</p>
<p>It&apos;s important to keep these updated in your standalone app. Prior to
Django 1.7 the accepted way of doing this was by using a third party
standalone app called South. Without South installed a user could
install an app and set up the database tables using Django&apos;s <code>syncdb</code>
command but would have no control over later changes to the database.</p>
<p>You&apos;re probably already familiar with model migrations but in the
context of your own project.</p>
<p>Django 1.7 introduced native database migrations, obviating the need for
a third-party tool like South and at the same time making database
schema or migration files a core part of Django apps.</p>
<h2 id="using-a-sample-project">Using a sample project</h2>
<p>In your existing Django projects you can easily make a change to a model
and then run the <code>makemigrations</code> to automatically generate a schema
migration file.</p>
<pre><code>python manage.py makemigrations myapp
</code></pre><p>With a standalone app we&apos;re in a similar position as we were with
testing: finding a project substitute. As with testing, we&apos;ll need to
substitute a way of using these commands.</p>
<p>The first way to do this is to add a stripped down
example project to your app&apos;s package folder from which you can include
your app and build migrations. This is far superior since there&apos;s no
copying and pasting like a dummy.</p>
<p>You do this by starting a project, called &quot;example&quot; right in the root of
your package directory. You can strip down the settings file to just the
bare minimum, including the <code>INSTALLED_APPS</code>.</p>
<p>This turns out to be something of a pain in the tucchus too.</p>
<blockquote>
<p>The first way of going about this is including and installing the app in
another project somewhere, creating the migrations, and copying them
over to your app. I&apos;m not telling you this because you should do it.
Don&apos;t do this. But I have, and if you have, then you&apos;re not alone. If
you haven&apos;t, good for you.</p>
<p>A significant downside to this method, aside from being boneheaded and
requiring lots of extra work that&apos;s not repeatable by anyone else, is
that it requires you to ensure you&apos;re always running the other project
on the same Python PATH (i.e. virtualenv).</p>
</blockquote>
<h2 id="using-a-helper-script">Using a helper script</h2>
<p>A yet better way of doing this is inspired by the runtests.py test
script so beloved in standalone apps. We create a single script in the
root of the project - I&apos;ll call it manage.py here since its going to
function in the same way - and before running the command it will
configure Django&apos;s settings. Now we can run Django commands like
makemigrations right from the package root.</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> django
<span class="hljs-keyword">from</span> django.conf <span class="hljs-keyword">import</span> settings

INSTALLED_APPS = [
    <span class="hljs-string">&quot;django.contrib.auth&quot;</span>,
    <span class="hljs-string">&quot;django.contrib.admin&quot;</span>,
    <span class="hljs-string">&quot;django.contrib.contenttypes&quot;</span>,
    <span class="hljs-string">&quot;django.contrib.sites&quot;</span>,
    <span class="hljs-string">&quot;myapp&quot;</span>,
]

settings.configure(
    DEBUG=<span class="hljs-keyword">True</span>,
    USE_TZ=<span class="hljs-keyword">True</span>,
    USE_I18N=<span class="hljs-keyword">True</span>,
    DATABASES={
        <span class="hljs-string">&quot;default&quot;</span>: {
            <span class="hljs-string">&quot;ENGINE&quot;</span>: <span class="hljs-string">&quot;django.db.backends.sqlite3&quot;</span>,
        }
    },
    MIDDLEWARE_CLASSES=(),
    SITE_ID=<span class="hljs-number">1</span>,
    INSTALLED_APPS=INSTALLED_APPS,
    ROOT_URLCONF=<span class="hljs-string">&quot;tests.urls&quot;</span>,
)

django.setup()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:
    <span class="hljs-keyword">from</span> django.core.management <span class="hljs-keyword">import</span> execute_from_command_line
    execute_from_command_line(sys.argv)
</code></pre>
<blockquote>
<p>This is part of release management (chapter X), but aim to include only the
migrations necessary for each change. For your first app, this would
ideally be one initial migration. There shouldn&apos;t be a need for anyone
to create the table initially and then make successive changes, if it&apos;s
never been out in the wild before. Obvious exceptions to this are if
you&apos;re already making extensive use of this app and it&apos;s got to be drop
in into your own projects.</p>
</blockquote>
<p>For your first release, we&apos;ll just make an initial migration and call it
a day.</p>
<pre><code>python manage.py makemigrations myapp
</code></pre>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="docs.html" class="navigation navigation-prev " aria-label="Previous page: Documenting your app">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="templates.html" class="navigation navigation-next " aria-label="Next page: Templates">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Model migrations","level":"1.2.5","depth":2,"next":{"title":"Templates","level":"1.2.6","depth":2,"path":"part1/templates.md","ref":"part1/templates.md","articles":[]},"previous":{"title":"Documenting your app","level":"1.2.4","depth":2,"path":"part1/docs.md","ref":"part1/docs.md","articles":[]},"dir":"ltr"},"config":{"plugins":["include-codeblock"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"include-codeblock":{"check":false,"edit":false,"fixlang":false,"lang":"","template":"default","theme":"chrome","unindent":false},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Ben Lopatin","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Django Standalone Apps","gitbook":"*"},"file":{"path":"part1/migrations.md","mtime":"2018-09-29T17:54:35.769Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2018-09-29T18:04:38.723Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

